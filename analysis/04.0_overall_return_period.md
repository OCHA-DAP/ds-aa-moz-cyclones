---
jupyter:
  jupytext:
    text_representation:
      extension: .md
      format_name: markdown
      format_version: '1.3'
      jupytext_version: 1.16.4
  kernelspec:
    display_name: .venv
    language: python
    name: python3
---

# Computing overall return period

```python
%load_ext jupyter_black

import pandas as pd
import numpy as np
from src.constants import *
from src.utils import *
from src.datasources import imerg, codab
```

```python
# Lists of storm events
readiness_storms = ["FAVIO", "IRINA", "DINEO", "IDAI", "ELOISE"]
action_storms = [
    "FAVIO",
    "JOKWE",
    "DINEO",
    "IDAI",
    "ELOISE",
    "GOMBE",
    "FREDDY",
]
obs_ws_storms = ["DINEO", "IDAI", "ELOISE", "FREDDY", "FILIPO"]
obs_rain_storms = ["FAVIO", "ANA", "GOMBE", "FREDDY"]

df = storm_df.copy()
```

```python
# Sort the DataFrame by 'Total Affected' in descending order
# Round values in 'Total Affected' and 'CERF Allocations' columns
df_sorted = df.sort_values(by="Total Affected", ascending=False)

# Apply styling
styled_df = (
    df_sorted.style.map(
        highlight_true,
        subset=[
            "Readiness",
            "Action",
            "Observational Rainfall",
            "Observational Wind Speed",
        ],
    )
    .map(color_bar_affected, subset=["Total Affected"])
    .map(color_bar_cerf, subset=["CERF Allocations"])
    .format(
        {
            "Total Affected": lambda x: (
                f"{int(x):,}" if pd.notna(x) else ""
            ),  # Format with commas, no decimals, NaN as blank
            "CERF Allocations": lambda x: (
                f"{int(x):,}" if pd.notna(x) else ""
            ),  # Format with commas, no decimals, NaN as blank
        }
    )
    .set_table_styles(
        {"": [{"selector": "table", "props": "background-color: white;"}]}
    )
)

# Display the styled DataFrame
styled_df
```

Return Period for Readiness

```python
num_years_storms = 18
num_ecmwf_years = 45
readiness_rate = (df[df["Readiness"]].shape[0]) / num_years_storms
print(f"The readiness activation rate is {round(readiness_rate*100,1)}%")
print(f"The readiness return period is 1-in-{round(1/readiness_rate, 1)} years")
```

Return Period for Action: 4 years

```python
action_rate = 1 / 4
print(f"The action activation rate is {round(action_rate*100,1)}%")
print(f"The action return period is 1-in-{round(1/action_rate, 1)} years")
```

Return Period for Readiness + Action

```python
readiness_and_action = (
    df[(df["Readiness"]) & (df["Action"])].shape[0]
) / num_years_storms
readiness_action_rate = readiness_rate + action_rate - readiness_and_action
print(
    f"The readiness or action activation rate is {round(readiness_action_rate*100,1)}%"
)
print(
    f"The readiness or action return period is 1-in-{round(1/readiness_action_rate, 1)} years"
)
```

Return Period for Observational : Wind Speed >= 48 knots

```python
obs_ws_rate = (df[df["Observational Wind Speed"]].shape[0]) / num_years_storms
print(f"The observational wind speed activation rate is {round(obs_ws_rate*100,1)}%")
print(
    f"The observational wind speed return period is 1-in-{round(1/obs_ws_rate, 1)} years"
)
```

Return Period for Observational : Rainfall >= 40 mm

```python
obs_rain_rate = (df[df["Observational Rainfall"]].shape[0]) / num_years_storms
print(f"The observational rainfall activation rate is {round(obs_rain_rate*100,1)}%")
print(
    f"The observational rainfall return period is 1-in-{round(1/obs_rain_rate, 1)} years"
)
```

Return Period for Observational

```python
observational = (
    df[(df["Observational Rainfall"]) | (df["Observational Wind Speed"])].shape[0]
) / num_years_storms
print(f"The observational rainfall activation rate is {round(observational*100,1)}%")
print(
    f"The observational rainfall return period is 1-in-{round(1/observational, 1)} years"
)
```

Return Period for Readiness + Action + Observational

```python
readiness_and_action_obs = (
    df[
        ((df["Readiness"]) | (df["Action"]))
        & ((df["Observational Rainfall"]) | (df["Observational Wind Speed"]))
    ].shape[0]
) / num_years_storms
readiness_action_rate = readiness_and_action + observational - readiness_and_action_obs
print(
    f"The readiness or action or observational activation rate is {round(readiness_action_rate*100,1)}%"
)
print(
    f"The readiness or action or observational return period is 1-in-{round(1/readiness_action_rate, 1)} years"
)
```
