---
jupyter:
  jupytext:
    text_representation:
      extension: .md
      format_name: markdown
      format_version: '1.3'
      jupytext_version: 1.16.4
  kernelspec:
    display_name: .venv
    language: python
    name: python3
---

# Return Period for La ReUnion Best Track Data


This notebook reviews the return period using La ReUnion Best Track data

```python
%load_ext jupyter_black
%load_ext autoreload
%autoreload 2
```

```python
import geopandas as gpd
import pandas as pd
import math
from pathlib import Path
import os
from datetime import datetime
from shapely.geometry import Point
from src.datasources import codab, rsmc, helpers
from src.constants import *
```

```python
save_dir = rsmc.DATA_DIR / "public" / "exploration" / "moz" / "ecmwf_hindcast"
```

```python
adm2_path = (
    Path(AA_DATA_DIR)
    / "public"
    / "raw"
    / "moz"
    / "cod_ab"
    / "moz_admbnda_adm2_ine_20190607.shp"
)
gdf_adm2 = gpd.read_file(adm2_path)
gdf_adm2_sel = gdf_adm2[gdf_adm2.ADM2_PT.isin(ADMS2)]
gdf_adm2_sel.plot()
```

```python
adm = codab.load_codab(aoi_only=True)
adm.plot()
```

```python
adm2_setting = False
if adm2_setting:
    adm = gdf_adm2_sel.copy()
```

```python
# loading all actual cyclone tracks
cyclone_tracks = pd.read_csv(
    rsmc.DATA_DIR
    / "private"
    / "raw"
    / "moz"
    / "rsmc"
    / "data_cyclone_SWIO_19851986_to_20222023.csv"
)
```

```python
cyclone_tracks["Lat"] = cyclone_tracks["Lat"].apply(
    lambda x: -x if x > 0 else x
)
cyclone_tracks_buffer = cyclone_tracks.copy()
cyclone_tracks_buffer["RMW_km"] = cyclone_tracks_buffer["RMW (mn)"] * KPH2KNOTS
```

```python
cyclone_tracks_buffer["RMW_km"] = (
    cyclone_tracks_buffer["RMW_km"].fillna(0.001).replace(0, 0.001)
)
```

```python
cyclone_tracks["geometry"] = cyclone_tracks.apply(
    lambda row: Point(row["Lon"], row["Lat"]), axis=1
)
cyclone_tracks_gdf = gpd.GeoDataFrame(
    cyclone_tracks, geometry="geometry", crs=EPSG_CRS
)
cyclone_tracks_buffer["geometry"] = cyclone_tracks.apply(
    lambda row: Point(row["Lon"], row["Lat"]), axis=1
)
cyclone_tracks_gdf_buffer = gpd.GeoDataFrame(
    cyclone_tracks_buffer, geometry="geometry", crs=EPSG_CRS
)
cyclone_tracks_gdf_buffer = cyclone_tracks_gdf_buffer.to_crs(epsg=MOZ_CRS)
cyclone_tracks_gdf_buffer["geometry"] = (
    cyclone_tracks_gdf_buffer.geometry.buffer(
        cyclone_tracks_gdf_buffer["RMW_km"]
        * 1000  # Convert RMW from km to meters
    )
)
cyclone_tracks_gdf_buffer = cyclone_tracks_gdf_buffer.to_crs(epsg=GEO_CRS)
```

```python
cyclone_tracks_sel = gpd.sjoin(
    cyclone_tracks_gdf, adm, how="inner", predicate="intersects"
)
cyclone_tracks_sel_adm2 = gpd.sjoin(
    cyclone_tracks_gdf, gdf_adm2_sel, how="inner", predicate="intersects"
)
cyclone_tracks_sel_buffer = gpd.sjoin(
    cyclone_tracks_gdf_buffer, adm, how="inner", predicate="intersects"
)
cyclone_tracks_sel_adm2_buffer = gpd.sjoin(
    cyclone_tracks_gdf_buffer,
    gdf_adm2_sel,
    how="inner",
    predicate="intersects",
)
```

```python
cyclone_tracks_sel.plot()
```

```python
cyclone_tracks_sel_buffer.plot()
```

```python
cyclone_tracks_sel_adm2_buffer["RMW_km"].plot()
```

```python
cyclone_tracks_sel["Name"].unique()
```

```python
helpers.calculate_storm_return_period_la_reunion(
    df=cyclone_tracks_sel,
    wind_speed_kmh=THRESHOLD_SPEED_OPT1,
    start_year=1980,
    num_storms_year=1,
)
```

```python
helpers.calculate_storm_return_period_la_reunion(
    df=cyclone_tracks_sel_adm2,
    wind_speed_kmh=THRESHOLD_SPEED_OPT1,
    start_year=1980,
    num_storms_year=1,
)
```

```python
helpers.calculate_storm_return_period_la_reunion(
    df=cyclone_tracks_sel,
    wind_speed_kmh=THRESHOLD_SPEED_OPT2,
    start_year=1980,
    num_storms_year=1,
)
```

```python
helpers.calculate_storm_return_period_la_reunion(
    df=cyclone_tracks_sel_adm2,
    wind_speed_kmh=THRESHOLD_SPEED_OPT2,
    start_year=1980,
    num_storms_year=1,
)
```

With Buffer

```python
helpers.calculate_storm_return_period_la_reunion(
    df=cyclone_tracks_sel_buffer,
    wind_speed_kmh=THRESHOLD_SPEED_OPT1,
    start_year=1980,
    num_storms_year=1,
)
```

```python
helpers.calculate_storm_return_period_la_reunion(
    df=cyclone_tracks_sel_adm2_buffer,
    wind_speed_kmh=THRESHOLD_SPEED_OPT1,
    start_year=1980,
    num_storms_year=1,
)
```

```python
helpers.calculate_storm_return_period_la_reunion(
    df=cyclone_tracks_sel_buffer,
    wind_speed_kmh=THRESHOLD_SPEED_OPT2,
    start_year=1980,
    num_storms_year=1,
)
```

```python
helpers.calculate_storm_return_period_la_reunion(
    df=cyclone_tracks_sel_adm2_buffer,
    wind_speed_kmh=THRESHOLD_SPEED_OPT2,
    start_year=1980,
    num_storms_year=1,
)
```
